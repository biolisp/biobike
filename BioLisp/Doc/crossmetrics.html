<!--;;; +============================================================================+;;; | Copyright (c) 2001, 2002, 2003, 2004 JP Massar, Jeff Shrager, Mike Travers |;;; |                                                                            |;;; | Permission is hereby granted, free of charge, to any person obtaining      |;;; | a copy of this software and associated documentation files (the            |;;; | "Software"), to deal in the Software without restriction, including        |;;; | without limitation the rights to use, copy, modify, merge, publish,        |;;; | distribute, sublicense, and/or sell copies of the Software, and to         |;;; | permit persons to whom the Software is furnished to do so, subject to      |;;; | the following conditions:                                                  |;;; |                                                                            |;;; | The above copyright notice and this permission notice shall be included    |;;; | in all copies or substantial portions of the Software.                     |;;; |                                                                            |;;; | THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,            |;;; | EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF         |;;; | MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.     |;;; | IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY       |;;; | CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,       |;;; | TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE          |;;; | SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                     |;;; +============================================================================+--></pre><p align="left">Back to <a href=index.html>BioBike Documentation Contents</a></p><html><head><title>BioBike: Creating and Using CrossMetric Database Tables</title></head><body><center></b><p><h2><b>Creating and Using CrossMetric Database Tables</h2></b></p><p></p></center><p align="right">Copyright (c) 2003 by Sumudu W Watugala and <ahref="http://aracyc.stanford.edu/~jshrager/personal/index.html">JeffShrager</a></p><p>"CrossMetrics?!  What's a cross metric?" you ask.... A CrossMetric isany real-valued measure (that is, any floating point number, like3.1416) that can be interpreted as something like the distance betweentwo things.  The standard (biological) example of a CrossMetric is thee-value that results from Blast (which you can read more about <ahref=http://www.ncbi.nlm.nih.gov/BLAST/tutorial/Altschul-1.html#head2>here</a>).In the case of Blast, there is theoretically a metric (the e-value)between any two genes, representing something like the similarity ofthese two genes.<p>If there are, say, 100 genes (set A) blasted aginst 100 other genes(set B, which could be the same as set A, in which case it's aself-cross), you get 100x100, or 10,000 e-values. This image is why wecall it a "CrossMetric" -- because it results from the "crosscomparison" of many things against all of many other things -- onepair at a time for all possible pairs.<p>Now, in practice, esp. with a metric like Blast, most of the scoresare so low (that is, the e-value is high, meaning that the similarityis low) that it's not worth recording them because, for all practicalpurposes, the pair of genes is not very similar.  So perhaps the100x100 cross above would result in, say, 1000 <i>significant</i>cross measures, at an e-value less than 1e-10, for example.<p>Once you have computed values for a cross metric, there are number ofvery useful things that you can do with them.  The simplest is just tolook up what's near (that is, similar to, in the case of Blast) yourfavorite gene.  In BioBike, the (crossmatched-genes-of ...) functionreads out precomputed results of cross metrics that have already beencomputed.<p>Let G be the set of all the genes with known sequences in theBioBike database.  Consider the cross metric created by blasting Gagainst itself. This cross metric has already been precomputed in theBioBike server and stored in a database table called CROSSBLAST.(All of the cross tables are called CROSSmetricname; We'll see this alittle later.)<p>To get information from a cross table you can use the functionCROSSMATCHED-GENES-OF, which has a number of required and keywordarguments:<p><pre>(crossmatched-genes-of   gene        (required -- for example: "slr1694")   table-name  (required -- for example: "crossblast")   :threshold  (keyword -- only show crosses whose measure                  is compared successfully against threhold.  Can be :all)   :comparison (keyword -- the comparison to use, e.g., :le, ">=", the default      is less-than (:lt))   :threshold-field (keyword -- the field in TABLE-NAME to extract      the value to be compared against THRESHOLD, defaults to "evalue")   :organisms  (keyword -- A list or organisms or :all; only those genes     belonging to these organisms are returned)   :genes      (keyword -- A list of genes; only those genes belonging to this     list are returned)   )Example:  >> (crossmatched-genes-of "alr1894" "crossblast")  ::   ((#$alr1894 3.58979d-136) (#$slr0886 5.97227d-107) (#$tlr1502 1.7982d-103)   (#$syn681 6.84902d-95) (#$promit.contig475.gene3512 2.20325d-93)   (#$pmm0453 2.89092d-77) (#$slr1994 2.73103d-43) (#$all3836 2.73103d-43)   (#$alr4456 3.95276d-34) (#$all0968 8.80584d-34) ...)  >> (length *)  :: 77</pre><p>Since the crossblast table was made initially with all matches whosee-value was less than 1, all of these will have e-values less than 1,even though we didn't specify an optional threshold.<p>If you only need blast results of a gene for E-values below thedefault, simply specify a threshold as:<p><pre>  >> (crossmatched-genes-of #$alr1894 "crossblast" :threshold 1e-25))  ::   ((#$alr1894 3.58979d-136) (#$slr0886 5.97227d-107) (#$tlr1502 1.7982d-103)   (#$syn681 6.84902d-95) (#$promit.contig475.gene3512 2.20325d-93)   (#$pmm0453 2.89092d-77) (#$slr1994 2.73103d-43) (#$all3836 2.73103d-43)   (#$alr4456 3.95276d-34) (#$all0968 8.80584d-34) ...)  >> (length *)  :: 17</pre><p>Similarly, you can specify a list of genes or a list of organisms thesearch is restricted to.  The results satisfying all the constraints willbe returned.<p><pre>  >> (crossmatched-genes-of #$alr1894 "crossblast" 	:genes '(#$all0475 #$syn2989 #$all1418)))  :: ((#$all1418 5.72103d-25) (#$all0475 2.24973d-21) (#$syn2989 1.66843d-16))  >> (crossmatched-genes-of #$alr1894 "crossblast" 	:threshold 1e-15 :organisms '(#$promed4))  :: ((#$pmm0453 2.89092d-77) (#$pmm0535 1.90451d-20))</pre><p><hr><p><h3>Making a cross metric table from your own data</h3><p>The crossblast table is built in, but you might want to createcross-tables of your own.  A common example is correlations amonggenes in microarray data, but you can do this for any metric that youinvent that corresponds to something which is a measure between twoitems of a set of items you'd like to investigate.<p> To create a crossmetric table of your own, use the function:create-crossmetric-table:<p><pre>(create-cross-table  function   (required -- indicates the function that will               be applied between every pair of entries in the data list)  data-list  (required -- the list of genes (or whatever)               to be crossed with one another through the metric function)  table-name (required -- gives a name to your table)  if-exists  (keyword -- what to do if the table already exists.  Defaults                to :warn-and-supersed.  Other options are :error, :supersede,                and nil (do not create table and return immediately).)  commutative? (keyword -- if A and B are data elements, is FUNCTION                 called on just (A B) or on both (A B) and (B A) ?  The                 default is T, only call on (A B), not both.)  do-identity? (keyword -- if T, call FUNCTION on (A A), for every A)</pre><p> FUNCTION must take two arguments, and return a list of three elements,which are the three values which go into the table for each table entry.These are the 'from_id' (a string), the 'to_id' (a string), and the value(a number).Example:  <pre>>> (setq hihara-table (load-hihara-table)):: #&lt;COMMON-LISP-USER::TABLE-DATA @ #x72303282&gt;>> (setq hihara-genes (table-data-col hihara-table 0 :list)):: #(#$ssr3571 #$ssr3570 #$ssr3532 #$ssr3467 #$ssr3465 #$ssr3451 #$ssr3410  #$ssr3409 #$ssr3402 #$ssr3383 ...)>> (create-crossmetric-table      (lambda (g1 g2) 	(list (#^Fname g1) (#^Fname g2)          (second             (correlate (coerce (table-data-data-row hihara-table g1) 'list)	               (coerce (table-data-data-row hihara-table g2) 'list)))))     (subseq hihara-genes 0 100)	     "mytempcross"):: ;; 5050 records entered into table mytempcrossNIL</pre><p> That's rather complicated, don't you think!  The hard part is thefunction -- that LAMBDA thing in the middle.  The problem is thatCREATE-CROSS-TABLE needs to have a function of two arguments -- nomore, no less! -- which it will call on every combination of thingsin the data-list.  So, it's going to call:<pre>  (function gene1 gene2)  (function gene1 gene3)  .... for every combination of genes!</pre><p> But we don't have a function that does exactly what we want, whichis to correlate the given genes in the hihara data.  So we need tomake one up.  We could have defined one as usual, and then used ithere, but since it's just five lines it's a tad silly to define awhole new function for this, plus it gives us the opportunity toexplain temporary functions to you...  BioBike has a was to maketemporary functions, and LAMBDA is how you do this.  So, the (lambda... ...)  thing is making a temporary function (which has no name!),with two arguments (g1 and g2), which does the gene correlation, andreturns a list of three things, as it is specified to do.<p> The other thing of note is that we only did the cross-correlationon the first 100 genes of the hihara data.  That's because there are3079 genes in the hihara table and if we let it do thecross-correlation on all of them we'd be creating about 5,000,000records in our table.  That would take a long time!<p>It turns out that creating and using temporary functions is apretty important thing to learn how to do; once you master it, you'llfind that you can use it all over the place in BioBike!  In fact,any place that you need a temporary function, you can put a lambdaexpression similar to the one above.<p> Once you've run the example, it will create a cross table ofcorrelations for the Hihara data for the first 100 pairs of genes inthe Synechocystis organism.  And you access this table just the way wedid with the Anyway, once you get this to work, it will create a crosstable of the correlations in the Hihara microarray data for every pairof genes in Synechocystis! (This can take a little time!) Each entrycontains the ids of 2 data points and the correlation coefiecientbetween them.  Once it's done, you can refer to the table just the waywe did with the CROSSMATCHED-GENES-OF function we were using above.<p> So let's first find a name of a gene, by looking in the table wecreated, then use it to extract evalues of some of its crossmatches:<pre>>> (with-organisms-db (db) (esql "select * from mytempcross limit 2")):: (("ssr3571" "ssr3571" 1) ("ssr3571" "ssr3570" 0.853186))>>  (crossmatched-genes-of "ssr3571" "mytempcross"        :threshold 1.0e-2 :threshold-field "distance"):: ((#$ssr1114 -0.173121) (#$ssr1375 -0.414053) (#$ssr1558 -0.32149) (#$ssr1562 -0.102829) (#$ssr1766 -0.017223) (#$ssr2047 -0.14332) (#$ssr2061 -0.861334) (#$ssr2803 -0.0403051) (#$ssr2806 -0.24267) (#$ssr2831 -0.149954) ...)</pre><p>However, there's actually something much more interesting that we wantto do with these cross tables....<p><hr><p><p><h3>Clustering by Cross-Matrics</h3><p>Once you have a table of cross metrics, like the blast table, ormytempcross that we made just above containing the cross-correlationof some genes in Synechocystis with one-another as represented in theHihara data, you can use these to form "gene neighborhoods" -- thatis, genes that are near one another by whatever metric you havedeveloped. (We're assuming throughout that the things crossed aregenes, although you can actually do it with any object that you have across metric for!) A neighborhood of genes is defined as all the genesthat are near one another -- that is, all of those that<i>transitivly</i> "touch" one another by the given metric.<p>Suppose that we have three genes: G1, G2, and G3.  The blast e-valuefrom G1 to G2 is 1e-10, and the blast e-value from G2 to G3 is 1e-10,but the blast e-value from G1 to G3 is only 1e-5.  If we set athreshold at 1e-7, we'll see G1-G2, and G2-G3, but not G1-G3.  Butbecause the neighborhood relationship is <i>transitive</i>, wheneverwe have a situation like this, these are all put into the sameneighborhood.<p>If you understand this, then you can tell that there's going to besome very strict threshold (like 1e-100), where nothing is nearanything else, and also some very weak threshold (like 10.0) whereeverything is in the same neighborhood!  (Actually, we can't everreally reach these limits with the current Blast table because, on theone hand, it stops at 1.0, and on the otherhand, there are someentries that have e-values of 0.0! But conceptually we could reachthese limits.)<p><pre>Eg:>> (blastgene "alr1894" "1.0")::&#60;EQUAL hash-table with 1446 entries @ #x71b0b692&#62;</pre>(Note that the threshold ("1.0") is entered as a string.)<p>This is simply an initialization step. Next use (give-grapha-threshold) to see relations at different E-values. ie, (give-graph0) would give the clustering of genes that are most similar.<p>As seen in the examples below the output is a list of lists, where agene in a sub-list is related to every other gene in that sub-list byan E-value of at least the specified threshold.<p>You can click on the genes to see the gene frame of each gene, or map theresult to see similarities in gene function.<p><pre>Eg:  >> (give-graph 1e-15)  ::  ((#$alr1894 #$slr1994 #$all3836 #$tlr1502 "syn681" #$slr0886    #$promit.contig475.gene3512 "promed1067" #$alr2142 #$alr5182    #$alr5286 #$alr4456 #$slr0315)   (#$alr1894 #$all3836 #$tlr1502 "syn681" #$slr0886    #$promit.contig475.gene3512 "promed1067" #$slr2124 #$alr2142    #$tll1310 #$sll1709 #$alr5182 #$alr5286 #$alr4456 #$all2963 "syn1405"    #$alr3897 #$all0968 #$all1418 #$slr0315)   (#$alr1894 #$tlr1502 "syn681" #$slr0886 #$promit.contig475.gene3512    "promed1067" #$slr2124 #$alr2142 #$tll1310 "promed1165" #$all0475    #$sll1709 #$alr5182 #$alr5286 #$alr4456 #$tll0511 "syn2989" #$all2963    "syn1405" #$alr5358 #$alr3897 #$all0352 #$sll0330 #$all0968 #$all1418       #$slr0315)   (#$alr1894 #$slr0886 #$promit.contig475.gene3512 "promed1067"    #$slr2124 #$alr2142 #$tll1310 "promed1165" #$all0475 #$sll1709    #$alr5182 #$alr5286 #$alr4456 #$tll0511 #$tll0931 #$all2963 "syn1405"    #$alr5358 #$alr3897 #$all0352 #$sll0330 #$all0968 #$all1418    #$slr0315) ...)  >> (give-graph 1e-45)::(("syn681" #$tlr1502 #$slr0886 #$promit.contig475.gene3512 "promed1067"  #$alr1894) ("syn1631" #$tll0021 #$sll0753 "promed1512" #$alr0212) (#$all0968 #$sll0330) (#$slr1051 #$tll1693 "promed102" #$all4391) (#$all1644 #$alr5353) (#$all1649 #$alr2679 #$alr2680) (#$all1743 "promed1170") (#$promit.contig475.gene431 "syn2989" "promed1165" #$alr5286) (#$all2891 #$tll1891) (#$promit.contig475.gene420 "syn3219" "promed1258") (#$all3805 #$tll0931) (#$promit.contig475.gene3082 "syn3463") (#$promit.contig475.gene2637 #$promit.contig475.gene2638) (#$alr1722 "promed1687" #$promit.contig475.gene1158 "syn1018") (#$promit.contig475.gene2053 #$slr1208) (#$alr1909 #$sll1376) (#$alr2142 #$slr0315) (#$promit.contig475.gene1103 "syn135" "promed971") (#$alr5286 "promed1165" "syn2989") (#$alr5286 #$tll1310))>> (give-graph 0)::((#$syn681 #$tlr1502 #$slr0886 #$promit.contig475.gene3512 "promed1067"  #$alr1894) (#$syn1631 #$tll0021 #$sll0753 "promed1512" #$alr0212) (#$all0968 #$sll0330) (#$slr1051 #$tll1693 "promed102" #$all4391) (#$all1644 #$alr5353) (#$all1649 #$alr2679 #$alr2680) (#$all1743 "promed1170") (#$promit.contig475.gene431 #$syn2989 "promed1165" #$alr5286) (#$all2891 #$tll1891) (#$promit.contig475.gene420 #$syn3219 "promed1258") (#$all3805 #$tll0931) (#$promit.contig475.gene3082 #$syn3463) (#$promit.contig475.gene2637 #$promit.contig475.gene2638) (#$alr1722 "promed1687" #$promit.contig475.gene1158 #$syn1018) (#$promit.contig475.gene2053 #$slr1208) (#$alr1909 #$sll1376) (#$alr2142 #$slr0315) (#$promit.contig475.gene1103 #$syn135 "promed971") (#$alr5286 "promed1165" #$syn2989) (#$alr5286 #$tll1310))</pre><p><p><h3>Clustering by correlation</h3><p><p>Using similar steps you can see the relation of genes in a data-set. In the initialization step you must specify the name of the table containing the data of interest, a threshold (bearing in mind that the correlation coefficient runs from -1 to 1, it would be sensible to pick |threshold| > 0.3 ). Additionally, you can specify the comparision (>, >=, <= etc. ). <p><pre>Eg:>> (blastgene "sll0924" :threshold 0.4 :table-name 'hiharadat):: #&#60;EQUAL hash-table with 20322 entries @ #x71af028a&#62;</pre><p>Next you can compare the correlation results at different thresholds. Remember to specify the comparision function.<p><pre>Eg:>> (give-graph 0.95 :compare '>=)::((#$sll0183 #$sll0253 #$sll0742 #$sll0261 #$sll0869 #$sll0911 #$sll0614  #$sll0789 #$sll0157 #$sll0171 ...) (#$sll0183 #$sll0742 #$sll0869 #$sll0171 #$sll0763 #$sll0708 #$sll0184  #$sll0888 #$sll0762 #$sll0892 ...) (#$sll0183 #$sll0261 #$sll0614 #$sll0789 #$sll0337 #$sll0683 #$sll0553  #$sll0263 #$sll0595 #$sll0071 ...) (#$sll0183 #$sll0869 #$sll0911 #$sll0157 #$sll0171 #$sll0763 #$sll0684  #$sll0184 #$sll0888 #$sll0762 ...) (#$sll0183 #$sll0911 #$sll0157 #$sll0171 #$sll0684 #$sll0888 #$sll0863  #$sll0683 #$sll0553 #$sll0263 ...) (#$sll0183 #$sll0614 #$sll0789 #$sll0337 #$sll0683 #$sll0553 #$sll0263  #$sll0595 #$sll0071 #$sll0266 ...)...)>> (give-graph 0.99 :compare '>=)::((#$sll0183 #$sll0253 #$sll0863 #$sll0683 #$sll0553 #$sll0779 #$sll0263  #$sll0595 #$sll0071 #$sll0266 ...) (#$sll0183 #$sll0863 #$sll0263 #$sll0595 #$sll0071 #$sll0741) (#$sll0183 #$sll0683 #$sll0553 #$sll0263 #$sll0595 #$sll0071 #$sll0266  #$sll0741) (#$sll0183 #$sll0779 #$sll0595 #$sll0741) (#$sll0888 #$sll0892 #$sll0763 #$sll0184 #$sll0779) (#$sll0888 #$sll0171 #$sll0869 #$sll0669) (#$sll0888 #$sll0169 #$sll0869 #$sll0669) (#$sll0031 #$sll0703 #$sll0377) (#$sll0860 #$sll0867 #$sll0194 #$sll0273 #$sll0356 #$sll0481) (#$sll0860 #$sll0194 #$sll0876 #$sll0273 #$sll0887 #$sll0356 #$sll0269  #$sll0481 #$sll0720) ...)>> (give-graph 1 :compare '>=):: ((#$sll0183 #$sll0253) (#$sll0031 #$sll0703))</body></html>